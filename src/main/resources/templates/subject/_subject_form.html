<div th:fragment="subjectForm(subject, listCourse)"
     th:remove="tag"
     xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

    <div class="ui error message"></div>

    <!-- Title input -->
    <div class="required field" th:classappend="${#fields.hasErrors('title')}? 'error'">
        <label th:text="#{subject.title.label}">Title</label>
        <input type="text"
               name="title"
               th:field="*{title}"
               class="ob-subject-creation-4"
               autofocus="autofocus"/>
        <input type="hidden"
               name="owner"
               th:field="*{owner}"/>
    </div>

    <!-- Course selection -->
    <div class="field ob-subject-creation-5" style="margin-top: 10px;">
        <label th:text="#{course.create.action.label}">Select the associated course :</label>
        <div style="margin-top: 5px">
            <select class="ui dropdown fluid" th:field="*{course}">
                <option th:text="#{course.not.associate.choice}" th:value="-1"></option>
                <option th:each="courseIt: ${listCourse}" th:value="${courseIt.id}" th:text="${courseIt.title}"></option>
            </select>
        </div>
    </div>

    <!-- Public checkbox -->
    <div class="field" style="margin-top: 16px;">
        <label th:text="#{subject.form.public}">Make subject public</label>
        <div class="ui toggle checkbox">
            <input type="checkbox" name="public" th:field="*{public}" class="publicCheckbox">
            <label></label>
        </div>
    </div>

    <!-- Hidden Description textarea -->
    <div class="field descriptionField" style="margin-top: 16px; display: none;">
        <label th:text="#{subject.description.label}">Description</label>
        <textarea name="description" th:field="*{description}" rows="3"></textarea>
    </div>

    <script th:inline="javascript">
        $(document).ready(function () {
            // Initialize dropdown
            $('.ui.dropdown').dropdown();

            // Form validation
            $('.ui.form').form({
                fields: {
                    title: {
                        identifier: 'title',
                        rules: [
                            {
                                type: 'empty',
                                prompt: /*[[#{subject.title.mandatory}]]*/ ''
                            }
                        ]
                    }
                }
            });

            let publicCheckbox = $('.publicCheckbox');
            let descriptionField = $('.descriptionField');
            // Handle showing/hiding the Description textarea based on the checkbox state
            publicCheckbox.change(function () {
                if ($(this).is(':checked')) {
                    console.log('checked');
                    descriptionField.show();
                } else {
                    descriptionField.hide();
                }
            });

            // Check the state on page load (in case it's already checked)
            if (publicCheckbox.is(':checked')) {
                descriptionField.show();
            }
        });
    </script>
</div>
