<!--
  ~ Elaastic - formative assessment system
  ~ Copyright (C) 2019. University Toulouse 1 Capitole, University Toulouse 3 Paul Sabatier
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<div th:fragment="subjectForm(subject, listCourse)"
     th:remove="tag"
     xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

    <div class="ui error message"></div>

    <!-- Title input -->
    <div class="required field" th:classappend="${#fields.hasErrors('title')}? 'error'">
        <label th:text="#{subject.title.label}">Title</label>
        <input type="text"
               name="title"
               th:field="*{title}"
               class="ob-subject-creation-4"
               autofocus="autofocus"/>
        <input type="hidden"
               name="owner"
               th:field="*{owner}"/>
    </div>

    <!-- Course selection -->
    <div class="field ob-subject-creation-5" style="margin-top: 10px;">
        <label th:text="#{course.create.action.label}">Select the associated course :</label>
        <div style="margin-top: 5px">
            <select class="ui dropdown fluid" th:field="*{course}">
                <option th:text="#{course.not.associate.choice}" th:value="-1"></option>
                <option th:each="courseIt: ${listCourse}" th:value="${courseIt.id}" th:text="${courseIt.title}"></option>
            </select>
        </div>
    </div>

    <!-- Public checkbox -->
    <div class="field" style="margin-top: 16px;">
        <label th:text="#{subject.form.shareToggle}">Share this subject with community</label>
        <div class="ui toggle checkbox">
            <input type="checkbox" name="public" th:field="*{public}" class="publicCheckbox">
            <label></label>
        </div>
        <br/>
        <div style="display: inline; font-size: .9rem; font-style: italic;">
            <span th:text="#{subject.public.licence}">
                Subject shared with the community is distributed under
            </span>
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.fr" target="_blank"> Creative Commons BY-NC-SA 4.0</a>
            <span th:text="#{subject.public.available}">
                and available on
            </span>
            <a th:href="${@environment.getProperty('elaastheque.url')}" target="_blank"> Elaastheque</a>
        </div>
    </div>

    <!-- Hidden Description textarea -->
    <div class="field descriptionField" style="margin-top: 16px; display: none;">
        <label th:text="#{subject.description.label}">Description</label>
        <textarea name="description" th:field="*{description}" rows="3"></textarea>
    </div>

    <script th:inline="javascript">
        $(document).ready(function () {
            // Initialize dropdown
            $('.ui.dropdown').dropdown();

            // Form validation
            $('.ui.form').form({
                fields: {
                    title: {
                        identifier: 'title',
                        rules: [
                            {
                                type: 'empty',
                                prompt: /*[[#{subject.title.mandatory}]]*/ ''
                            }
                        ]
                    }
                }
            });

            let publicCheckbox = $('.publicCheckbox');
            let descriptionField = $('.descriptionField');
            // Handle showing/hiding the Description textarea based on the checkbox state
            publicCheckbox.change(function () {
                if ($(this).is(':checked')) {
                    console.log('checked');
                    descriptionField.show();
                } else {
                    descriptionField.hide();
                }
            });

            // Check the state on page load (in case it's already checked)
            if (publicCheckbox.is(':checked')) {
                descriptionField.show();
            }
        });
    </script>
</div>
