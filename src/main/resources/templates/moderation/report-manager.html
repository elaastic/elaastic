<!--
  ~ Elaastic - formative assessment system
  ~ Copyright (C) 2019. University Toulouse 1 Capitole, University Toulouse 3 Paul Sabatier
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!DOCTYPE html>
<html lang="en"
      th:replace="layout/3columns :: 3columns(title=~{::title}, pageSpecificMenu=~{::#pageSpecificMenu}, aside=~{::aside#layout-aside}, modalAside=~{::#modal-aside}, content=~{::section},extraHeader=~{::head/script})"
      xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta name="layout" content="left_menu-elaastic">
        <title th:text="|elaastic: #{reportManager.title}|">elaastic: Report Manager</title>
    </head>

    <body>

    <!--/*@thymesVar id="reportedCandidateModel" type="org.elaastic.questions.moderation.ReportedCandidateModel"*/-->
    <aside id="layout-aside">
        <div>
            <th:block th:each="reportedCandidateModel: ${allReportedCandidateModel}">
                <th:block
                        th:replace="moderation/components/_reported-element-item :: reportedElement(${reportedCandidateModel})"></th:block>
            </th:block>
            <th:block th:if="${allReportedCandidateModel.isEmpty()}">
                <div class="ui message info">
                    <div class="header" th:text="#{reportManager.noReportedItem}">No reported item</div>
                    <div th:text="#{reportManager.noReportedItem.description}">There are no reported items to display.
                    </div>
                </div>
            </th:block>
        </div>

        <style>
            .ui.selected.card {
                background-color: #fff4e6;
                color: #573a08;
            }
        </style>

        <script>

            $(function () {
                const detailReportCandidate = $('#detail-report-candidate');
                const loader = $('#loader');

                detailReportCandidate.hide();
                loader.hide();

                /**
                 * Update the container with the details of the selected item.
                 * @param idReportCandidate {number} The id of the selected item.
                 * @param reportedCandidate {HTMLElement} The selected item.
                 * @param isSelected {boolean} true if the item is selected false otherwise.
                 */
                function updateSelectedItem(idReportCandidate, reportedCandidate, isSelected) {
                    console.log('Selected item id : ' + idReportCandidate);
                    console.log(reportedCandidate);
                    console.log('Is selected : ' + isSelected);
                    console.log("Type : " + $(reportedCandidate).attr('reported-candidate-type'))

                    if (!isSelected) {
                        $('#no-selected-item').slideDown();
                        detailReportCandidate.slideUp();
                    } else {
                        $('#no-selected-item').hide();

                        loader.slideDown();
                        $.get('/report-manager/detail/' + $(reportedCandidate).attr('reported-candidate-type') + '/' + idReportCandidate)
                            .done(function (data) {
                                detailReportCandidate.slideDown();
                                console.log(data);
                                $('#reported-content').html(data.contentReported);

                                $('#report-reasons').empty();
                                data.reasons.forEach(function (reason) {
                                    $('#report-reasons').append('<div class="ui label">' + reason + '</div>');
                                });

                                if (data.comment == null) {
                                    $('#report-comment-parent').hide()
                                } else {
                                    $('#report-comment-parent').show()
                                    $('#report-comment').html(data.comment);
                                }
                                $('#reporter').text(data.reporter);
                                $('#graderThatHaveBeenReported').text(data.graderThatHaveBeenReported);
                                $('#numberOfReport').text(data.numberOfReport);
                            })
                            .fail(function () {
                                $('#detail-report-candidate').html('<div class="ui message error">An error occurred while loading the details of the selected item.</div>');
                            })
                            .always(function () {
                                loader.slideUp();
                            })
                        ;
                    }
                }

                $('.ui.card').click(function () {
                    let wasSelected = $(this).hasClass('selected');

                    $('.ui.card').removeClass('selected');

                    if (!wasSelected) {
                        $(this).addClass('selected');
                    }
                    updateSelectedItem($(this).attr('id-reported-Candidate'), $(this), !wasSelected);
                });
            })
        </script>
    </aside>

    <section>
        <script>
            $(function () {
                $('.ui.accordion').accordion();
            })
        </script>

        <div class="ui message info" id="no-selected-item" style="display: none">
            <div class="header" th:text="#{reportManager.noItemSelected}">No item selected</div>
            <div th:text="#{reportManager.noItemSelected.description}">Please select an item to see its details.</div>
        </div>
        <!--/*Loader*/-->
        <div class="ui message" id="loader" style="display: none">
            <div class="ui active inverted dimmer" style="background-color: rgba(255,255,255,.60)">
                <div class="ui text loader" th:text="#{common.loading}">Loading</div>
            </div>
            <div class="placeholder" style="height: 50px"></div>
        </div>
        <div class="ui container" id="detail-report-candidate">
            <div class="ui segment styled fluid accordion">
                <div class="title active">
                    <h1><i class="dropdown icon"></i><span th:text="#{reportManager.detail.title}"></span></h1>
                </div>
                <div class="active content" style="display: flex;flex-direction: column;gap: 10px;">
                    <div>
                        <h2 th:text="#{reportManager.detail.reportedContent.title}"></h2>
                        <div class="ui segment" id="reported-content">
                            Reported Content
                        </div>
                    </div>
                    <div>
                        <h2 th:text="#{reportManager.detail.reportReasons.title}"></h2>
                        <div id="report-reasons">
                        </div>
                    </div>
                    <div id="report-comment-parent">
                        <h2 th:text="#{reportManager.detail.comment.title}"></h2>
                        <div class="ui segment" id="report-comment">
                            Comment
                        </div>
                    </div>
                    <div>
                        <h2 th:text="#{reportManager.detail.reporter.title}"></h2>
                        <div class="ui label" id="reporter">Student</div>
                    </div>
                    <div>
                        <h2 th:text="#{reportManager.detail.studentReported.title}"></h2>
                        <div class="ui label" id="graderThatHaveBeenReported">Student</div>
                        <span th:text="#{reportManager.detail.numberOfReport.title}"></span>
                        <span class="ui label" id="numberOfReport">3</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="modal-aside">

    </div>

    </body>
</html>