<!--
  ~ Elaastic - formative assessment system
  ~ Copyright (C) 2019. University Toulouse 1 Capitole, University Toulouse 3 Paul Sabatier
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!DOCTYPE html>
<html lang="en"
      th:replace="layout/3columns :: 3columns(title=~{::title}, pageSpecificMenu=~{::#pageSpecificMenu}, aside=~{::aside#layout-aside}, modalAside=~{::#modal-aside}, content=~{::section},extraHeader=~{::head/script})"
      xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta name="layout" content="left_menu-elaastic">
        <title th:text="|elaastic: #{reportManager.title}|">elaastic: Report Manager</title>
    </head>

    <body>

    <!--/*@thymesVar id="reportedCandidateModel" type="org.elaastic.questions.moderation.ReportedCandidateModel"*/-->
    <aside id="layout-aside">
        <div th:replace="|player/assignment/sequence/components/_assignment-overview.html| :: assignmentOverview(${assignmentOverviewModel}, aside, false)"></div>

        <div class="ui segment attached">
            <div class="ui header" th:text="#{reportManager.itemContainer.title}"></div>
            <th:block th:each="reportedCandidateModel: ${allReportedCandidateModel}">
                <th:block
                        th:replace="moderation/components/_reported-element-item :: reportedElement(${reportedCandidateModel})"></th:block>
            </th:block>
            <th:block th:if="${allReportedCandidateModel.isEmpty()}">
                <div class="ui message info">
                    <div class="header" th:text="#{reportManager.noReportedItem}">No reported item</div>
                    <div th:text="#{reportManager.noReportedItem.description}">There are no reported items to display.
                    </div>
                </div>
            </th:block>
        </div>

        <style>
            .ui.selected.card {
                background-color: #fff4e6;
                color: #573a08;
            }
        </style>

        <script>

            $(function () {
                const detailReportCandidate = $('#detail-report-candidate');

                detailReportCandidate.hide();
                detailReportCandidate.removeClass("loading");

                /**
                 * Update the container with the details of the selected item.
                 * @param idReportCandidate {number} The id of the selected item.
                 * @param reportedCandidate {HTMLElement} The selected item.
                 * @param isSelected {boolean} true if the item is selected false otherwise.
                 */
                function updateSelectedItem(idReportCandidate, reportedCandidate, isSelected) {

                    if (!isSelected) {
                        $('#no-selected-item').slideDown();
                        detailReportCandidate.slideUp();
                    } else {
                        $('#no-selected-item').hide();
                        detailReportCandidate.addClass("loading");
                        detailReportCandidate.slideDown();

                        $.get('/report-manager/detail/' + $(reportedCandidate).attr('reported-candidate-type') + '/' + idReportCandidate)
                            .done(function (data) {
                                $('#reported-content').html(data.contentReported);

                                $('#report-reasons').empty();
                                data.reportReasonsI18N.forEach(function (reason) {
                                    $('#report-reasons').append('<li>' + reason + '</li>');
                                });

                                if (data.reportComment == null) {
                                    $('#report-comment-parent').hide()
                                } else {
                                    $('#report-comment-parent').show()
                                    $('#report-comment').html(data.reportComment);
                                }
                                $('#reporter').text(data.reporter);
                                $('#graderThatHaveBeenReported').text(data.graderThatHaveBeenReported);
                                if (data.type === "PEER_GRADING") {
                                    $('#user-icon').show();
                                    $('#laptop-icon').hide();
                                } else {
                                    $('#user-icon').hide();
                                    $('#laptop-icon').show();
                                }

                                $('#numberOfReport').text(data.numberOfReport);
                            })
                            .fail(function () {
                                $('#detail-report-candidate').html('<div class="ui message error">An error occurred while loading the details of the selected item.</div>');
                            })
                            .always(function () {
                                detailReportCandidate.removeClass("loading");
                            })
                        ;
                    }
                }

                $('.ui.card').click(function () {
                    let wasSelected = $(this).hasClass('selected');

                    $('.ui.card').removeClass('selected');

                    if (!wasSelected) {
                        $(this).addClass('selected');
                    }
                    updateSelectedItem($(this).attr('id-reported-Candidate'), $(this), !wasSelected);
                });
            })
        </script>
    </aside>

    <section>
        <script>
            $(function () {
                $('.ui.accordion').accordion();
            })
        </script>

        <!--/* No item in list message */-->
        <div class="ui message info" id="no-selected-item">
            <div class="header" th:text="#{reportManager.noItemSelected}">No item selected</div>
            <div th:text="#{reportManager.noItemSelected.description}">Please select an item to see its details.</div>
        </div>

        <!--/*Detail of the selected item*/-->
        <div class="ui container">
            <div class="ui segment styled fluid accordion" id="detail-report-candidate">

                <!--/* Title of the accordion */-->
                <div class="title active">
                    <h1><i class="dropdown icon"></i><span th:text="#{reportManager.detail.title}"></span></h1>
                </div>

                <!--/* Content of the accordion */-->
                <div class="active content" style="display: flex;flex-direction: column;gap: 10px;">

                    <!--/* Content reported */-->
                    <div class="ui segment vertical">
                        <h2 th:text="#{reportManager.detail.reportedContent.title}"></h2>
                        <div class="ui segment" id="reported-content">
                            Reported Content
                        </div>
                    </div>

                    <!--/* Reasons of the report */-->
                    <div class="ui segment vertical">
                        <h2 th:text="#{reportManager.detail.reportReasons.title}"></h2>
                        <ul id="report-reasons" class="ui list">
                        </ul>
                    </div>

                    <!--/* Comment of the report */-->
                    <div id="report-comment-parent" class="ui segment vertical">
                        <h2 th:text="#{reportManager.detail.comment.title}"></h2>
                        <div class="ui segment" id="report-comment">
                            Comment
                        </div>
                    </div>

                    <div class="ui segment vertical">
                        <div class="ui two column very relaxed grid">
                            <!--/* Author of the report */-->
                            <div class="column">
                                <h2 th:text="#{reportManager.detail.reporter.title}"></h2>
                                <div class="ui compact segment">
                                    <div style="display: flex; flex-direction: row">
                                        <i class="user circle icon"></i>
                                        <div id="reporter">Student</div>
                                    </div>
                                </div>
                            </div>

                            <!--/* Author of the evaluation */-->
                            <div class="column">
                                <h2 th:text="#{reportManager.detail.studentReported.title}"></h2>
                                <div class="ui compact segment">
                                    <div style="display: flex; flex-direction: row">
                                        <i class="user circle icon" id="user-icon"></i>
                                        <i class="laptop icon" id="laptop-icon"></i>
                                        <div id="graderThatHaveBeenReported">Student</div>
                                    </div>
                                </div>
                                <span th:text="#{reportManager.detail.numberOfReport.title}"></span>
                                <span class="ui label" id="numberOfReport">3</span>
                            </div>
                        </div>
                        <style>
                            .ui.vertical.divider.without-text::after,
                            .ui.vertical.divider.without-text::before {
                                height: 100%;
                            }
                        </style>
                        <div class="ui vertical divider without-text"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="modal-aside">

    </div>

    </body>
</html>